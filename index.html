<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dr. Bhavna â€“ Homeopathy System</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet"/>

<style>
body{background:#eef4fb}
.hidden{display:none}
.chat{height:45vh;overflow-y:auto}
.row{display:flex;gap:10px;margin-bottom:12px;max-width:85%}
.bot{align-self:flex-start}
.user{align-self:flex-end;flex-direction:row-reverse}
.avatar{width:38px;height:38px;border-radius:50%;display:flex;
align-items:center;justify-content:center;font-weight:bold;color:#fff}
.botA{background:#16a34a}
.userA{background:#2563eb}
.bubble{background:#fff;padding:12px;border-radius:14px;font-size:14px}
.card{border-left:4px solid #2563eb;background:#f8fafc;
padding:10px;border-radius:10px;margin-top:8px}
</style>
</head>

<body class="min-h-screen flex flex-col">

<!-- HEADER -->
<div class="bg-white p-4 shadow text-center">
  <h1 class="text-xl font-bold text-blue-700">
    Dr. Bhavna â€“ Homeopathy Consultation System
  </h1>
  <p class="text-xs text-gray-500">
    Classical Homeopathy â€¢ Clinical Decision Support
  </p>
</div>

<!-- CHAT -->
<div id="chat" class="chat max-w-3xl mx-auto p-4 flex flex-col"></div>

<!-- CHAT INPUT -->
<div class="bg-white p-4 shadow max-w-3xl mx-auto w-full">
  <input id="msg" class="border rounded w-full px-3 py-2 mb-2"
  placeholder="Describe symptoms in detailâ€¦">
  <div class="flex justify-between">
    <button id="ask" class="bg-blue-600 text-white px-4 py-2 rounded">Ask Doctor</button>
    <button id="clear" class="bg-red-500 text-white px-4 py-2 rounded">Clear</button>
  </div>
</div>

<!-- APPOINTMENT FORM -->
<div class="max-w-3xl mx-auto mt-6 bg-white p-4 rounded shadow">
<h3 class="font-bold mb-2">Patient Appointment / Complaint</h3>
<input id="pname" class="border p-2 w-full mb-2 rounded" placeholder="Patient Name">
<input id="page" class="border p-2 w-full mb-2 rounded" placeholder="Age">
<input id="pmobile" class="border p-2 w-full mb-2 rounded" placeholder="Mobile">
<textarea id="pcomplaint" class="border p-2 w-full mb-2 rounded"
placeholder="Main Complaint"></textarea>
<button onclick="savePatient()" class="bg-green-600 text-white px-4 py-2 rounded w-full">
Submit
</button>
</div>

<!-- ADMIN LOGIN -->
<div class="max-w-3xl mx-auto mt-6 bg-gray-100 p-4 rounded shadow">
<h3 class="font-bold text-red-700 mb-2">Doctor / Admin Login</h3>
<input id="adminUser" class="border p-2 w-full mb-2 rounded" placeholder="Username">
<input id="adminPass" type="password" class="border p-2 w-full mb-2 rounded" placeholder="Password">
<button onclick="adminLogin()" class="bg-red-600 text-white px-4 py-2 rounded w-full">
Login
</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden max-w-3xl mx-auto mt-6 bg-white p-4 rounded shadow">
<h3 class="font-bold mb-2">Admin Panel</h3>

<button onclick="downloadPatients()" class="bg-blue-600 text-white px-4 py-2 rounded w-full mb-2">
Download Patient CSV
</button>

<input type="file" id="csvRemedy" accept=".csv"
class="border p-2 w-full rounded">
<p class="text-xs text-gray-500 mt-1">
Upload Remedy CSV (name,keywords,symptoms,keynotes,potency)
</p>
</div>

<!-- FOOTER -->
<footer class="mt-auto bg-white p-4 text-center text-xs text-gray-600">
<strong>Disclaimer:</strong> Informational support only. Final treatment requires consultation.
</footer>

<script>
/* ================= DATA ================= */
let admin=false;
let patients=[];

let medicines=[
{name:"Belladonna",keywords:["fever","headache","throbbing"],symptoms:"Sudden fever, throbbing pain",keynotes:"Sudden violent onset",potency:"30C"},
{name:"Nux Vomica",keywords:["constipation","gas","irritable"],symptoms:"Constipation, gastric issues",keynotes:"Overworked, chilly",potency:"30C"},
{name:"Pulsatilla",keywords:["cold","yellow","cough"],symptoms:"Yellow discharge",keynotes:"Better open air",potency:"30C"},
{name:"Arnica",keywords:["injury","bruise"],symptoms:"Soreness after injury",keynotes:"Feels beaten",potency:"200C"},
{name:"Bryonia",keywords:["dry","motion","pain"],symptoms:"Pain worse motion",keynotes:"Better rest",potency:"30C"},
{name:"Rhus Tox",keywords:["stiff","better motion"],symptoms:"Stiff joints",keynotes:"Restlessness",potency:"30C"},
{name:"Sulphur",keywords:["burning","heat","chronic"],symptoms:"Burning sensations",keynotes:"Heat, philosophy",potency:"200C"},
{name:"Calcarea",keywords:["sweating","fatigue"],symptoms:"Weak, sweaty",keynotes:"Chilly, slow",potency:"30C"}
];

/* ================= CHAT ================= */
const chat=document.getElementById("chat");
const msg=document.getElementById("msg");

function add(type,text,html=false){
 const r=document.createElement("div");r.className="row "+type;
 const a=document.createElement("div");a.className="avatar "+(type=="bot"?"botA":"userA");
 a.innerText=type=="bot"?"Dr":"You";
 const b=document.createElement("div");b.className="bubble";
 html?b.innerHTML=text:b.innerText=text;
 r.append(a,b);chat.appendChild(r);chat.scrollTop=chat.scrollHeight;
}

/* Greeting */
add("bot",
"ðŸ™ Welcome to Dr. Bhavnaâ€™s Homeopathy Consultation System.\n\n" +
"Please describe symptoms with location, sensation, modalities and time.\n" +
"This system provides preliminary guidance only."
);

/* Ask */
document.getElementById("ask").onclick=()=>{
 if(!msg.value.trim())return;
 const t=msg.value.toLowerCase();msg.value="";
 add("user",t);

 const res=medicines.map(m=>{
  let s=0;m.keywords.forEach(k=>{if(t.includes(k))s++});
  return {...m,score:s};
 }).filter(m=>m.score>0).sort((a,b)=>b.score-a.score).slice(0,2);

 if(!res.length){add("bot","No close remedy match. Consultation advised.");return;}

 let h="";
 res.forEach(m=>{
  h+=`<div class="card">
  <b>${m.name}</b><br>
  Symptoms: ${m.symptoms}<br>
  Keynotes: ${m.keynotes}<br>
  ${admin?("<b>Potency:</b> "+m.potency):"<i>Potency visible to doctor only</i>"}
  </div>`;
 });
 add("bot",h,true);
};

document.getElementById("clear").onclick=()=>chat.innerHTML="";

/* ================= PATIENT ================= */
function savePatient(){
 const p={
  name:pname.value,age:page.value,mobile:pmobile.value,
  complaint:pcomplaint.value,date:new Date().toLocaleString()
 };
 if(!p.name||!p.mobile||!p.complaint){alert("Fill required fields");return;}
 patients.push(p);
 alert("Appointment saved");
 pname.value=page.value=pmobile.value=pcomplaint.value="";
}

/* ================= ADMIN ================= */
function adminLogin(){
 if(adminUser.value==="admin"&&adminPass.value==="admin123"){
  admin=true;
  adminPanel.classList.remove("hidden");
  alert("Admin logged in");
 }else alert("Invalid credentials");
}

function downloadPatients(){
 if(!patients.length){alert("No data");return;}
 let csv="Name,Age,Mobile,Complaint,Date\n";
 patients.forEach(p=>{
  csv+=`${p.name},${p.age},${p.mobile},"${p.complaint}",${p.date}\n`;
 });
 const b=new Blob([csv],{type:"text/csv"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(b);
 a.download="patients.csv";
 a.click();
}

/* ================= CSV IMPORT REMEDIES ================= */
csvRemedy.addEventListener("change",e=>{
 const f=e.target.files[0];if(!f)return;
 const r=new FileReader();
 r.onload=()=>{
  const rows=r.result.split("\n").slice(1);
  medicines=[];
  rows.forEach(x=>{
   const c=x.split(",");
   if(c.length<5)return;
   medicines.push({
    name:c[0],
    keywords:c[1].split("|"),
    symptoms:c[2],
    keynotes:c[3],
    potency:c[4]
   });
  });
  alert("Remedy database updated");
 };
 r.readAsText(f);
});
</script>

</body>
</html>
