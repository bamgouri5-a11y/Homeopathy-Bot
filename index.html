<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dr. Bhavna â€“ Homeopathy Chat</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet"/>
<style>
:root{--brand:#2563eb;--muted:#6b7280;--bg:#eef4fb}
body{background:var(--bg)}
.header{background:#fff;padding:14px;display:flex;gap:12px;align-items:center;justify-content:center;box-shadow:0 2px 10px rgba(0,0,0,.06)}
.header img{width:48px;height:48px;border-radius:10px;object-fit:cover}
.chat{height:62vh;overflow-y:auto;padding:14px}
.row{display:flex;gap:8px;margin:10px 0;max-width:85%}
.bot{align-self:flex-start}
.user{align-self:flex-end;flex-direction:row-reverse}
.avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
.botA{background:#16a34a}
.userA{background:var(--brand)}
.bubble{padding:12px 14px;border-radius:12px;font-size:14px;line-height:1.45}
.botB{background:#fff;border:1px solid #e6edf7}
.userB{background:#dbeafe}
.card{border-left:4px solid var(--brand);padding:8px 10px;margin:6px 0;border-radius:8px;background:#fff7ed}
.inputbar{background:#fff;padding:12px;position:sticky;bottom:0;box-shadow:0 -2px 10px rgba(0,0,0,.04)}
footer{background:#fff;padding:14px;text-align:center;font-size:13px;color:var(--muted);border-top:1px solid #eef2ff}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);align-items:center;justify-content:center}
.modal>div{background:#fff;width:92%;max-width:420px;padding:16px;border-radius:12px}
</style>
</head>
<body>

<header class="header">
  <img src="bot.png" alt="Logo">
  <div>
    <div class="font-bold text-blue-600">Dr. Bhavna â€“ Homeopathy Chat</div>
    <div class="text-xs text-gray-500">AI-assisted guidance</div>
  </div>
</header>

<main class="max-w-3xl mx-auto px-4">
  <div id="chat" class="chat"></div>
</main>

<div class="max-w-3xl mx-auto px-4 inputbar">
  <input id="msg" class="border rounded px-3 py-2 w-full mb-2" placeholder="Type or speak your problemâ€¦"/>
  <div class="flex justify-between items-center">
    <div class="flex gap-2">
      <button id="ask" class="bg-blue-600 text-white px-3 py-2 rounded">Ask Dr</button>
      <button id="clear" class="bg-red-500 text-white px-3 py-2 rounded">Clear</button>
      <button id="book" class="bg-green-600 text-white px-3 py-2 rounded">Book Appointment</button>
      <button id="export" class="bg-gray-700 text-white px-3 py-2 rounded">Export CSV</button>
    </div>
    <button id="mic" class="bg-green-600 text-white px-3 py-2 rounded">ðŸŽ¤</button>
  </div>
</div>

<footer class="mt-4">
  ðŸ“§ <a href="mailto:drbhavnabamania@gmail.com" class="text-blue-600 font-semibold">drbhavnabamania@gmail.com</a>
  <div class="mt-2"><strong>Disclaimer:</strong> Informational only. Consult Dr. Bhavna physically for diagnosis & dosage.</div>
</footer>

<!-- Appointment Modal -->
<div id="modal" class="modal">
  <div>
    <h3 class="font-bold mb-2">Book Appointment</h3>
    <input id="pName" class="border rounded w-full p-2 mb-2" placeholder="Patient Name">
    <input id="pEmail" class="border rounded w-full p-2 mb-2" placeholder="Email">
    <input type="date" id="pDate" class="border rounded w-full p-2 mb-2">
    <input type="time" id="pTime" class="border rounded w-full p-2 mb-2">
    <textarea id="pConcern" class="border rounded w-full p-2 mb-2" placeholder="Health concern"></textarea>
    <div class="flex justify-end gap-2">
      <button onclick="closeModal()" class="px-3 py-2 rounded bg-gray-300">Cancel</button>
      <button onclick="submitAppt()" class="px-3 py-2 rounded bg-green-600 text-white">Submit</button>
    </div>
  </div>
</div>

<script>
/* ===== State ===== */
const chatEl=document.getElementById('chat');
const msgEl=document.getElementById('msg');
let history=JSON.parse(localStorage.getItem('hb_hist')||'[]');
let remedies=[];

/* ===== Load remedies from JSON ===== */
fetch('remedies.json')
  .then(r=>r.json())
  .then(d=>remedies=d)
  .catch(()=>remedies=[]);

/* ===== Helpers ===== */
function render(item){
  const r=document.createElement('div');
  r.className='row '+(item.type==='bot'?'bot':'user');
  const a=document.createElement('div');
  a.className='avatar '+(item.type==='bot'?'botA':'userA');
  a.textContent=item.type==='bot'?'Dr':'You';
  const b=document.createElement('div');
  b.className='bubble '+(item.type==='bot'?'botB':'userB');
  if(item.html) b.innerHTML=item.text; else b.textContent=item.text;
  r.append(a,b); chatEl.appendChild(r); chatEl.scrollTop=chatEl.scrollHeight;
}
function add(type,text,html=false){
  const o={type,text,html}; history.push(o);
  localStorage.setItem('hb_hist',JSON.stringify(history)); render(o);
}
history.forEach(render);

/* ===== Remedy lookup ===== */
function lookup(q){
  q=q.toLowerCase();
  return remedies.filter(r=>r.keywords.some(k=>q.includes(k)));
}
function showRemedies(list){
  if(!list.length){ add('bot','No close match found. Please book an appointment.'); return; }
  let h='';
  list.forEach(r=>{
    h+=`<div class="card"><b>${r.name}</b><div>${r.symptoms}</div>
        <div><b>Potency:</b> ${r.potency} | <b>Dosage:</b> ${r.dosage}</div>
        <div>${r.notes}</div></div>`;
  });
  add('bot',h,true);
}

/* ===== Actions ===== */
document.getElementById('ask').onclick=()=>{
  const t=msgEl.value.trim(); if(!t) return;
  add('user',t); msgEl.value='';
  showRemedies(lookup(t));
};

document.getElementById('clear').onclick=()=>{
  history=[]; localStorage.removeItem('hb_hist'); chatEl.innerHTML='';
};

document.getElementById('export').onclick=()=>{
  let csv='type,text\n'+history.map(h=>`${h.type},"${h.text.replace(/"/g,'""')}"`).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='patient_history.csv'; a.click();
};

/* ===== Appointment ===== */
const modal=document.getElementById('modal');
document.getElementById('book').onclick=()=>{
  // auto-fill from last user message
  const lastUser=history.filter(h=>h.type==='user').pop();
  document.getElementById('pConcern').value=lastUser?lastUser.text:'';
  modal.style.display='flex';
};
function closeModal(){ modal.style.display='none'; }
function submitAppt(){
  closeModal();
  add('bot','Appointment request received. Our team will contact you shortly.');
}

/* ===== Mic ===== */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const r=new SR(); r.lang='en-IN';
  document.getElementById('mic').onclick=()=>r.start();
  r.onresult=e=>msgEl.value=e.results[0][0].transcript;
}else document.getElementById('mic').style.display='none';
</script>
</body>
</html>
