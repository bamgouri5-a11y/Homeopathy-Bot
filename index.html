<script>
/* ================= ADMIN CONFIG ================= */
const ADMIN_LOGIN="Bhavna";
const ADMIN_PASSWORD="Bhavna@123";
let admin=false;

/* ================= HASH ================= */
async function hash(t){
 const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));
 return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}
let storedHash="";
(async()=>storedHash=await hash(ADMIN_PASSWORD))();

/* ================= DATA ================= */
let patients=[];

/* ===== MEDICINE DATABASE (FIXED & WORKING) ===== */
const medicines=[
{
 name:"Belladonna",
 keywords:["fever","bukhar","headache","sir","throbbing","lal","sudden"],
 symptoms:"Sudden fever, throbbing headache, red hot face.",
 keynotes:"Sudden onset, heat, congestion, worse light & noise.",
 potency:"30C"
},
{
 name:"Nux Vomica",
 keywords:["constipation","kabz","gas","irritable","gussa","indigestion"],
 symptoms:"Constipation with frequent urging, gastric irritation.",
 keynotes:"Overworked, irritable, chilly patient.",
 potency:"30C"
},
{
 name:"Pulsatilla",
 keywords:["cold","jukam","yellow","peela","cough","changeable"],
 symptoms:"Thick yellow bland discharge, mild fever.",
 keynotes:"Better open air, worse heat.",
 potency:"30C"
},
{
 name:"Arnica",
 keywords:["injury","chot","bruise","lagna","trauma"],
 symptoms:"Soreness as if beaten, after injury.",
 keynotes:"Says nothing is wrong, fear of touch.",
 potency:"200C"
},
{
 name:"Bryonia",
 keywords:["dry","sookha","pain","movement","hilne","thirst"],
 symptoms:"Dry cough, pain worse slightest motion.",
 keynotes:"Better rest, wants quiet.",
 potency:"30C"
},
{
 name:"Rhus Tox",
 keywords:["stiff","akad","joint","jor","better motion","restless"],
 symptoms:"Joint stiffness, better by motion.",
 keynotes:"Restlessness, worse damp weather.",
 potency:"30C"
},
{
 name:"Sulphur",
 keywords:["burning","jalan","heat","garmi","chronic","skin"],
 symptoms:"Burning sensations, heat in feet.",
 keynotes:"Heat, chronic complaints.",
 potency:"200C"
},
{
 name:"Calcarea Carbonica",
 keywords:["weak","kamzori","sweating","pasina","cold","anxiety"],
 symptoms:"Weakness, head sweating, cold sensitivity.",
 keynotes:"Chilly, slow, anxious.",
 potency:"30C"
}
];

/* ================= CHAT ================= */
const chat=document.getElementById("chat");
const msg=document.getElementById("msg");

function add(type,text){
 const r=document.createElement("div");
 r.className="row "+type;
 const a=document.createElement("div");
 a.className="avatar "+(type==="bot"?"botA":"userA");
 a.innerText=type==="bot"?"Dr":"You";
 const b=document.createElement("div");
 b.className="bubble";
 b.innerText=text;
 r.append(a,b);
 chat.appendChild(r);
 chat.scrollTop=chat.scrollHeight;
}

/* GREETING */
add("bot",
"ðŸ™ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ Dr. Bhavna à¤•à¥‡ Homeopathy à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤®à¥‡à¤‚à¥¤\n\n" +
"à¤†à¤ª à¤…à¤ªà¤¨à¥‡ à¤²à¤•à¥à¤·à¤£ à¤¹à¤¿à¤¨à¥à¤¦à¥€ à¤¯à¤¾ English à¤®à¥‡à¤‚ à¤²à¤¿à¤–à¥‡à¤‚ à¤¯à¤¾ ðŸŽ¤ à¤¸à¥‡ à¤¬à¥‹à¤²à¥‡à¤‚à¥¤\n" +
"à¤¦à¤°à¥à¤¦ à¤•à¥€ à¤œà¤—à¤¹, à¤ªà¥à¤°à¤•à¤¾à¤°, à¤”à¤° à¤¬à¤¢à¤¼à¤¨à¥‡-à¤˜à¤Ÿà¤¨à¥‡ à¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤¦à¥‡à¤‚à¥¤"
);

/* ================= MIC (HINDI) ================= */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
 const r=new SR();
 r.lang="hi-IN";
 mic.onclick=()=>r.start();
 r.onresult=e=>msg.value=e.results[0][0].transcript;
}

/* ================= ASK (FIXED) ================= */
ask.onclick=()=>{
 if(!msg.value.trim()) return;

 const text=msg.value.toLowerCase();
 msg.value="";
 add("user",text);

 const results=medicines.map(m=>{
  let score=0;
  m.keywords.forEach(k=>{
   if(text.includes(k)) score++;
  });
  return {...m,score};
 }).filter(m=>m.score>0)
   .sort((a,b)=>b.score-a.score)
   .slice(0,2);

 if(!results.length){
  add("bot","à¤²à¤•à¥à¤·à¤£à¥‹à¤‚ à¤•à¥‡ à¤…à¤¨à¥à¤¸à¤¾à¤° à¤•à¥‹à¤ˆ à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤¦à¤µà¤¾ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¥€à¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤µà¥à¤¯à¤•à¥à¤¤à¤¿à¤—à¤¤ à¤ªà¤°à¤¾à¤®à¤°à¥à¤¶ à¤²à¥‡à¤‚à¥¤");
  return;
 }

 results.forEach(m=>{
  add("bot",
   `${m.name}\n`+
   `Symptoms: ${m.symptoms}\n`+
   `Keynotes: ${m.keynotes}\n`+
   (admin ? `Potency: ${m.potency}` : "Potency doctor à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤¤à¤¯ à¤•à¥€ à¤œà¤¾à¤à¤—à¥€")
  );
 });
};

/* CLEAR */
clear.onclick=()=>chat.innerHTML="";

/* ================= ADMIN LOGIN ================= */
async function adminLogin(){
 if(adminUser.value!==ADMIN_LOGIN){
  alert("Invalid login"); return;
 }
 const h=await hash(adminPass.value);
 if(h===storedHash){
  admin=true;
  adminPanel.classList.remove("hidden");
  alert("Admin logged in");
 }else{
  alert("Wrong password");
 }
}
</script>
